{"version":3,"file":"index-CQZcJRUZ.js","sources":["../../src/hooks/business/auth.ts","../../src/views/function/toggle-auth/index.vue"],"sourcesContent":["import { useAuthStore } from '@/store/modules/auth';\n\nexport function useAuth() {\n  const authStore = useAuthStore();\n\n  function hasAuth(codes: string | string[]) {\n    if (!authStore.isLogin) {\n      return false;\n    }\n\n    if (typeof codes === 'string') {\n      return authStore.userInfo.buttons.includes(codes);\n    }\n\n    return codes.some(code => authStore.userInfo.buttons.includes(code));\n  }\n\n  return {\n    hasAuth\n  };\n}\n","<script setup lang=\"ts\">\ndefineOptions({\n  name: \"function_toggle-auth\"\n});\n\nimport { computed, ref } from 'vue';\nimport { useRoute } from 'vue-router';\nimport { useLoading } from '@sa/hooks';\nimport { $t } from '@/locales';\nimport { useAppStore } from '@/store/modules/app';\nimport { useAuthStore } from '@/store/modules/auth';\nimport { useTabStore } from '@/store/modules/tab';\nimport { useAuth } from '@/hooks/business/auth';\n\nconst route = useRoute();\nconst appStore = useAppStore();\nconst authStore = useAuthStore();\nconst tabStore = useTabStore();\nconst { hasAuth } = useAuth();\nconst { loading, startLoading, endLoading } = useLoading();\n\ntype AccountKey = 'super' | 'admin' | 'user';\n\ninterface Account {\n  key: AccountKey;\n  label: string;\n  userName: string;\n  password: string;\n}\n\nconst accounts = computed<Account[]>(() => [\n  {\n    key: 'super',\n    label: $t('page.login.pwdLogin.superAdmin'),\n    userName: 'Super',\n    password: '123456'\n  },\n  {\n    key: 'admin',\n    label: $t('page.login.pwdLogin.admin'),\n    userName: 'Admin',\n    password: '123456'\n  },\n  {\n    key: 'user',\n    label: $t('page.login.pwdLogin.user'),\n    userName: 'User',\n    password: '123456'\n  }\n]);\n\nconst loginAccount = ref<AccountKey>('super');\n\nasync function handleToggleAccount(account: Account) {\n  loginAccount.value = account.key;\n\n  startLoading();\n  await authStore.login(account.userName, account.password, false);\n  tabStore.initTabStore(route);\n  endLoading();\n  appStore.reloadPage();\n}\n</script>\n\n<template>\n  <ASpace direction=\"vertical\" :size=\"16\">\n    <ACard :title=\"$t('route.function_toggle-auth')\" :bordered=\"false\" size=\"small\" class=\"card-wrapper\">\n      <ADescriptions layout=\"vertical\" bordered size=\"small\" :column=\"1\">\n        <ADescriptionsItem :label=\"$t('page.manage.user.userRole')\">\n          <ASpace>\n            <ATag v-for=\"role in authStore.userInfo.roles\" :key=\"role\">{{ role }}</ATag>\n          </ASpace>\n        </ADescriptionsItem>\n        <ADescriptionsItem ions-item :label=\"$t('page.function.toggleAuth.toggleAccount')\">\n          <ASpace>\n            <AButton\n              v-for=\"account in accounts\"\n              :key=\"account.key\"\n              :loading=\"loading && loginAccount === account.key\"\n              :disabled=\"loading && loginAccount !== account.key\"\n              @click=\"handleToggleAccount(account)\"\n            >\n              {{ account.label }}\n            </AButton>\n          </ASpace>\n        </ADescriptionsItem>\n      </ADescriptions>\n    </ACard>\n    <ACard :title=\"$t('page.function.toggleAuth.authHook')\" :bordered=\"false\" size=\"small\" class=\"card-wrapper\">\n      <ASpace>\n        <AButton v-if=\"hasAuth('B_CODE1')\">{{ $t('page.function.toggleAuth.superAdminVisible') }}</AButton>\n        <AButton v-if=\"hasAuth('B_CODE2')\">{{ $t('page.function.toggleAuth.adminVisible') }}</AButton>\n        <AButton v-if=\"hasAuth('B_CODE3')\">\n          {{ $t('page.function.toggleAuth.adminOrUserVisible') }}\n        </AButton>\n      </ASpace>\n    </ACard>\n  </ASpace>\n</template>\n\n<style scoped></style>\n"],"names":["useAuth","authStore","useAuthStore","hasAuth","codes","code","route","useRoute","appStore","useAppStore","tabStore","useTabStore","loading","startLoading","endLoading","useLoading","accounts","computed","$t","loginAccount","ref","handleToggleAccount","account"],"mappings":"kWAEO,SAASA,GAAU,CACxB,MAAMC,EAAYC,EAAa,EAE/B,SAASC,EAAQC,EAA0B,CACrC,OAACH,EAAU,QAIX,OAAOG,GAAU,SACZH,EAAU,SAAS,QAAQ,SAASG,CAAK,EAG3CA,EAAM,KAAaC,GAAAJ,EAAU,SAAS,QAAQ,SAASI,CAAI,CAAC,EAP1D,EAO0D,CAG9D,MAAA,CACL,QAAAF,CACF,CACF,iECNA,MAAMG,EAAQC,EAAS,EACjBC,EAAWC,EAAY,EACvBR,EAAYC,EAAa,EACzBQ,EAAWC,EAAY,EACvB,CAAE,QAAAR,CAAQ,EAAIH,EAAQ,EACtB,CAAE,QAAAY,EAAS,aAAAC,EAAc,WAAAC,CAAA,EAAeC,EAAW,EAWnDC,EAAWC,EAAoB,IAAM,CACzC,CACE,IAAK,QACL,MAAOC,EAAG,gCAAgC,EAC1C,SAAU,QACV,SAAU,QACZ,EACA,CACE,IAAK,QACL,MAAOA,EAAG,2BAA2B,EACrC,SAAU,QACV,SAAU,QACZ,EACA,CACE,IAAK,OACL,MAAOA,EAAG,0BAA0B,EACpC,SAAU,OACV,SAAU,QAAA,CACZ,CACD,EAEKC,EAAeC,EAAgB,OAAO,EAE5C,eAAeC,EAAoBC,EAAkB,CACnDH,EAAa,MAAQG,EAAQ,IAEhBT,EAAA,EACb,MAAMZ,EAAU,MAAMqB,EAAQ,SAAUA,EAAQ,SAAU,EAAK,EAC/DZ,EAAS,aAAaJ,CAAK,EAChBQ,EAAA,EACXN,EAAS,WAAW,CAAA"}